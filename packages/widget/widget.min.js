!function(){"use strict";const e={apiUrl:"http://localhost:3000/api/submit",formSelector:"[data-freeform]",successMessage:"✅ Форма успешно отправлена!",errorMessage:"❌ Ошибка отправки. Попробуйте позже.",honeypotField:"_honeypot"};class t{constructor(t={}){this.config={...e,...t},this.forms=[],this.initialized=!1}init(){this.initialized?console.warn("FreeFormAPI Widget уже инициализирован"):(this.forms=Array.from(document.querySelectorAll(this.config.formSelector)),0!==this.forms.length?(this.forms.forEach(e=>{this.setupForm(e)}),this.initialized=!0,console.log(`✅ FreeFormAPI Widget инициализирован, найдено форм: ${this.forms.length}`)):console.warn("FreeFormAPI: формы с data-freeform не найдены"))}setupForm(e){this.addHoneypotField(e),e.addEventListener("submit",t=>{t.preventDefault(),this.handleSubmit(e)});const t=e.querySelector('button[type="submit"], input[type="submit"]');t&&(t.style.position="relative")}addHoneypotField(e){if(e.querySelector(`[name="${this.config.honeypotField}"]`))return;const t=document.createElement("input");t.type="text",t.name=this.config.honeypotField,t.style.display="none",t.setAttribute("aria-hidden","true"),t.setAttribute("tabindex","-1"),t.autocomplete="off",e.appendChild(t)}async handleSubmit(e){const t=e.getAttribute("data-freeform"),o=e.querySelector('button[type="submit"], input[type="submit"]'),s=o?o.innerHTML:"";o&&(o.innerHTML="⏳ Отправка...",o.disabled=!0);try{const o=new FormData(e),s={formId:t,email:o.get("email")||"",message:o.get("message")||"",[this.config.honeypotField]:o.get(this.config.honeypotField)||""};Object.keys(s).forEach(e=>{""===s[e]&&delete s[e]});const r=await fetch(this.config.apiUrl,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)}),i=await r.json();r.ok&&i.success?(this.showSuccess(e,i.message||this.config.successMessage),e.reset()):this.showError(e,i.message||this.config.errorMessage)}catch(t){console.error("FreeFormAPI Widget error:",t),this.showError(e,this.config.errorMessage)}finally{o&&(o.innerHTML=s,o.disabled=!1)}}showSuccess(e,t){this.showMessage(e,t,"success")}showError(e,t){this.showMessage(e,t,"error")}showMessage(e,t,o="info"){const s=e.querySelector(".freeform-message");s&&s.remove();const r=document.createElement("div");r.className=`freeform-message freeform-${o}`,r.innerHTML=t,r.style.cssText=`\n        margin: 10px 0;\n        padding: 10px;\n        border-radius: 4px;\n        border: 1px solid ${"success"===o?"#4CAF50":"#F44336"};\n        background-color: ${"success"===o?"#E8F5E9":"#FFEBEE"};\n        color: ${"success"===o?"#2E7D32":"#C62828"};\n        font-family: Arial, sans-serif;\n        font-size: 14px;\n      `,e.parentNode.insertBefore(r,e.nextSibling),setTimeout(()=>{r.parentNode&&(r.style.transition="opacity 0.5s",r.style.opacity="0",setTimeout(()=>{r.parentNode&&r.remove()},500))},5e3)}submitForm(e,t){return document.querySelector(`[data-freeform="${e}"]`)?fetch(this.config.apiUrl,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({formId:e,...t,[this.config.honeypotField]:""})}).then(e=>e.json()):(console.error(`FreeFormAPI: форма с ID "${e}" не найдена`),Promise.reject(new Error("Form not found")))}}window.FreeFormAPI={init:function(e={}){"loading"===document.readyState?document.addEventListener("DOMContentLoaded",()=>{new t(e).init()}):new t(e).init()},submit:function(e,o){return(new t).submitForm(e,o)}},document.querySelector(e.formSelector)&&setTimeout(()=>{window.FreeFormAPI.init()},100)}();